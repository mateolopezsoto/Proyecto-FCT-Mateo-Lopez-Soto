import{a as K}from"./chunk-P2IZZ4D7.js";import{a as X,c as q,e as G,o as J}from"./chunk-3FRVCO6D.js";import{Aa as ee,C as _,Ca as H,E as P,G as d,J as n,K as i,L as h,M as O,N as p,O as u,Q as a,R as g,S,T as A,Y as R,_ as k,aa as I,ba as D,c as Z,d as y,fa as C,ha as F,ja as N,ka as T,la as z,na as V,o as x,oa as $,p as E,pa as L,t as m,u as f,wa as U,xa as B,z as r,za as j}from"./chunk-6KVODD7N.js";var w=Z(ee());function te(l,t){l&1&&(n(0,"tr")(1,"td",11)(2,"div",12),a(3,"Cargando datos..."),i()()())}function ne(l,t){l&1&&(n(0,"tr")(1,"td",13),a(2," Non se atoparon reservas. "),i()())}function ie(l,t){if(l&1){let e=O();n(0,"tr")(1,"td")(2,"div",14)(3,"span",15),a(4),i(),n(5,"small"),a(6),i(),n(7,"small",16),a(8),i()()(),n(9,"td")(10,"div",17)(11,"strong"),a(12),i(),n(13,"small"),a(14),i()()(),n(15,"td")(16,"div",18)(17,"span",19),a(18),k(19,"date"),i(),h(20,"br"),n(21,"span",20),a(22),k(23,"slice"),i()()(),n(24,"td")(25,"span",21),a(26),i()(),n(27,"td",22)(28,"button",23),p("click",function(){let s=m(e).$implicit,c=u();return f(c.onCambiarEstado(s))}),a(29,"Estado"),i(),n(30,"button",24),p("click",function(){let s=m(e).$implicit,c=u();return f(c.onDetalles(s))}),a(31,"Detalles"),i()()()}if(l&2){let e=t.$implicit;r(4),A(" ",(e.usuario==null?null:e.usuario.nome)||"Usuario Desconocido"," ",(e.usuario==null?null:e.usuario.apelidos)||""," "),r(2),g((e.usuario==null?null:e.usuario.correo)||"Sen correo"),r(2),S("ID: ",e.id_usuario,""),r(4),g((e.instalacion==null?null:e.instalacion.nome)||"Instalaci\xF3n borrada"),r(2),g(e.instalacion==null||e.instalacion.tipo==null?null:e.instalacion.tipo.nome_tipo),r(4),g(I(19,10,e.data_reserva,"dd/MM/yyyy")),r(4),g(D(23,13,e.hora_inicio||(e.horario==null?null:e.horario.hora_inicio)||"??:??",0,5)),r(3),d("ngClass",(e.estado==null?null:e.estado.toLowerCase())||""),r(),S(" ",e.estado," ")}}function oe(l,t){if(l&1){let e=O();n(0,"div",25)(1,"button",26),p("click",function(){m(e);let s=u();return f(s.cambiarPagina(-1))}),h(2,"i",27),a(3," Anterior "),i(),n(4,"span",28),a(5),i(),n(6,"button",26),p("click",function(){m(e);let s=u();return f(s.cambiarPagina(1))}),a(7," Seguinte "),h(8,"i",29),i()()}if(l&2){let e=u();r(),d("disabled",e.paginaActual()===1),r(4),A(" P\xE1xina ",e.paginaActual()," de ",e.totalPaginas()," "),r(),d("disabled",e.paginaActual()===e.totalPaginas())}}var Q=class l{adminService=x(K);authService=x(H);router=x(U);filtroUsuario=_("");filtroData=_("");paginaActual=_(1);pageSize=_(10);filteredReservasList=C(()=>{let t=this.adminService.reservas(),e=this.filtroUsuario().toLowerCase(),o=this.filtroData();return t.filter(s=>{let c=s.usuario?.nome?.toLowerCase()||"",b=s.usuario?.apelidos?.toLowerCase()||"",v=s.usuario?.correo?.toLowerCase()||"",M=s.id_usuario?.toString().toLowerCase()||"",W=!e||M.includes(e)||c.includes(e)||b.includes(e)||v.includes(e),Y=!o||s.data_reserva===o;return W&&Y})});totalPaginas=C(()=>{let t=this.filteredReservasList().length;return Math.ceil(t/this.pageSize())});reservasFiltradas=C(()=>{let t=this.filteredReservasList(),e=(this.paginaActual()-1)*this.pageSize(),o=e+this.pageSize();return t.slice(e,o)});constructor(){F(()=>{let t=this.filteredReservasList().length,e=Math.ceil(t/this.pageSize());this.paginaActual()>e&&e>0?this.paginaActual.set(1):e===0&&this.paginaActual()!==1&&this.paginaActual.set(1)})}ngOnInit(){if(this.authService.usuario()?.rol?.nome_rol!=="Administrador"){this.router.navigate(["/reservas"]);return}this.adminService.cargarReservas()}cambiarPagina(t){let e=this.paginaActual()+t;e>=1&&e<=this.totalPaginas()&&this.paginaActual.set(e)}onCambiarEstado(t){return y(this,null,function*(){let{value:e}=yield w.default.fire({title:"Cambiar estado",input:"select",inputOptions:{Confirmada:"Confirmada",Pendente:"Pendente",Cancelada:"Cancelada"},inputPlaceholder:"Selecciona un estado",inputValue:t.estado,showCancelButton:!0,confirmButtonColor:"#4285F4"});e&&e!==t.estado&&this.adminService.cambiarEstadoReserva(t.id_reserva,e)})}onDetalles(t){let e="N/A",o="N/A";t.horario?(e=t.horario.hora_inicio?t.horario.hora_inicio.slice(0,5):"N/A",o=t.horario.hora_fin?t.horario.hora_fin.slice(0,5):"N/A"):t.hora_inicio&&(e=t.hora_inicio.slice(0,5),o=t.hora_fin.slice(0,5));let s=t.instalacion?.nome||"Instalaci\xF3n desco\xF1ecida",c=t.instalacion?.tipo?.nome_tipo||"Tipo desco\xF1ecido",b=t.usuario?`${t.usuario.nome} ${t.usuario.apelidos}`:"Usuario eliminado",v=t.usuario?.correo||"N/A",M=t.usuario?.telefono||"N/A";w.default.fire({title:"Detalles da reserva",html:`
        <div style="text-align: left">
          <p><strong>ID Reserva:</strong> ${t.id_reserva}</p>
          <hr>
          <h4>Datos do usuario</h4>
          <p><strong>Nome:</strong> ${b}</p>
          <p><strong>Correo:</strong> ${v}</p>
          <p><strong>Tel\xE9fono:</strong> ${M}</p>
          <hr>
          <h4>Instalaci\xF3n</h4>
          <p><strong>Nome:</strong> ${s}</p>
          <p><strong>Tipo:</strong> ${c}</p>
          <p><strong>Horario:</strong> ${e} - ${o}</p>
        </div>
        `,confirmButtonText:"Pechar",confirmButtonColor:"#6c757d"})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=E({type:l,selectors:[["app-admin-reservas"]],standalone:!0,features:[R],decls:30,vars:6,consts:[[1,"container"],[1,"filters"],["type","text","placeholder","Filtrar por usuario (Nome/Correo)",3,"ngModelChange","ngModel"],["type","date","placeholder","Filtrar por data",3,"ngModelChange","ngModel"],[3,"click"],[1,"table-responsive"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","pagination-controls",4,"ngIf"],[2,"margin-top","20px","text-align","center"],["routerLink","/reservas",1,"btn-volver"],["colspan","5",2,"text-align","center","padding","20px"],[1,"loading-spinner"],["colspan","5",2,"text-align","center","padding","30px","font-style","italic","color","#888"],[1,"user-info"],[1,"user-name"],[1,"user-id",2,"font-size","0.75em","color","#aaa"],[1,"inst-info"],[1,"date-info"],[1,"date"],[1,"time"],[1,"status-badge",3,"ngClass"],[1,"actions"],[1,"status-btn",3,"click"],[1,"details-btn",3,"click"],[1,"pagination-controls"],[1,"page-btn",3,"click","disabled"],[1,"fa-solid","fa-chevron-left"],[1,"page-indicator"],[1,"fa-solid","fa-chevron-right"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"h1"),a(2,"Panel de Xesti\xF3n de Reservas"),i(),n(3,"div",1)(4,"input",2),p("ngModelChange",function(c){return o.filtroUsuario.set(c)}),i(),n(5,"input",3),p("ngModelChange",function(c){return o.filtroData.set(c)}),i(),n(6,"button",4),p("click",function(){return o.adminService.cargarReservas()}),a(7,"Recargar"),i()(),n(8,"div",5)(9,"table")(10,"thead")(11,"tr")(12,"th"),a(13,"Usuario"),i(),n(14,"th"),a(15,"Instalaci\xF3n"),i(),n(16,"th"),a(17,"Data / Hora"),i(),n(18,"th"),a(19,"Estado"),i(),n(20,"th"),a(21,"Acci\xF3ns"),i()()(),n(22,"tbody"),P(23,te,4,0,"tr",6)(24,ne,3,0,"tr",6)(25,ie,32,17,"tr",7),i()()(),P(26,oe,9,4,"div",8),n(27,"div",9)(28,"button",10),a(29,"\u2190 Volver ao Cat\xE1logo"),i()()()),e&2&&(r(4),d("ngModel",o.filtroUsuario()),r(),d("ngModel",o.filtroData()),r(18),d("ngIf",o.adminService.loading()),r(),d("ngIf",!o.adminService.loading()&&o.reservasFiltradas().length===0),r(),d("ngForOf",o.reservasFiltradas()),r(),d("ngIf",o.adminService.reservas().length>o.pageSize()))},dependencies:[L,N,T,z,$,V,J,X,q,G,j,B],styles:['@charset "UTF-8";*[_ngcontent-%COMP%]{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif}[_nghost-%COMP%]{display:block;background-color:#f5f5f5;min-height:100vh;padding:20px}.container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;background-color:#fff;padding:20px;border-radius:12px;box-shadow:0 2px 10px #0000000d}h1[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px;color:#333}.filters[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;background-color:#f9f9f9;padding:15px;border-radius:8px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:10px 15px;border-radius:8px;border:1px solid #ccc;font-size:1rem;flex:1}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;border:none;background-color:#4285f4;color:#fff;cursor:pointer;transition:background .3s;font-weight:700}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#357ae8}.table-responsive[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background-color:#fff;border-radius:12px;overflow:hidden;box-shadow:0 0 15px #0000000d}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:12px 15px;text-align:left;border-bottom:1px solid #eee}th[_ngcontent-%COMP%]{background-color:#4285f4;color:#fff;font-weight:600}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}.user-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-name[_ngcontent-%COMP%]{font-weight:500}.user-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#777}.inst-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.inst-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.05rem;margin-bottom:3px}.inst-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#555;font-size:.85rem}.status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:.85rem;font-weight:700}.status-badge.confirmada[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.status-badge.pendente[_ngcontent-%COMP%]{background-color:#fff3cd;color:#856404}.status-badge.cancelada[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;margin-right:5px;border:none;border-radius:6px;cursor:pointer;font-size:.9rem;color:#fff;transition:background .3s}.status-btn[_ngcontent-%COMP%]{background-color:orange}.status-btn[_ngcontent-%COMP%]:hover{background-color:#e69500}.details-btn[_ngcontent-%COMP%]{background-color:#28a745}.details-btn[_ngcontent-%COMP%]:hover{background-color:#218838}.btn-volver[_ngcontent-%COMP%]{padding:10px 20px;background-color:#6c757d;color:#fff;border:none;border-radius:8px;cursor:pointer}.pagination-controls[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:15px;margin-top:20px}.page-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 15px;background-color:#fff;color:#4285f4;border:1px solid #4285F4;border-radius:8px;cursor:pointer;font-weight:700;transition:all .2s}.page-btn[_ngcontent-%COMP%]:hover:not([disabled]){background-color:#dae8fc;box-shadow:0 2px 4px #4285f433}.page-btn[disabled][_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed;background-color:#f0f0f0;color:#999;border-color:#ccc}.page-indicator[_ngcontent-%COMP%]{font-size:1rem;color:#333;font-weight:600}@media (max-width: 768px){.filters[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.pagination-controls[_ngcontent-%COMP%]{gap:10px}.page-btn[_ngcontent-%COMP%]{padding:8px 12px}}']})};export{Q as AdminReservasComponent};
