import{Aa as y,Ba as h,C as o,a as l,b as p,c as g,d as n,g as e,l as d,o as u,qa as m}from"./chunk-6KVODD7N.js";var r=g(y());var f=class c{http=u(m);apiUrl=h.apiUrl;instalacions=o([]);tipos=o([]);loading=o(!1);reservas=o([]);estatisticas=o(null);constructor(){}cargarDatos(){return n(this,null,function*(){if(!this.loading()){this.loading.set(!0);try{let[t,a]=yield Promise.all([e(this.http.get(`${this.apiUrl}/admin/instalacions`)),e(this.http.get(`${this.apiUrl}/tipos-instalacion`))]);this.instalacions.set(t||[]),this.tipos.set(a||[])}catch(t){console.error("Error cargando datos de administraci\xF3n:",t),r.default.fire("Erro","Non se puideron cargar os datos de administraci\xF3n","error")}finally{this.loading.set(!1)}}})}eliminarInstalacion(t){return n(this,null,function*(){if((yield r.default.fire({title:"Est\xE1s seguro/a?",text:"Non poder\xE1s reverter esta acci\xF3n. Borrarase a instalaci\xF3n se non ten reservas activas",icon:"warning",showCancelButton:!0,confirmButtonColor:"#DC3545",cancelButtonColor:"#6c757d",confirmButtonText:"Si, eliminar!",cancelButtonText:"Cancelar"})).isConfirmed){this.loading.set(!0);try{yield e(this.http.delete(`${this.apiUrl}/admin/instalacions/${t}`)),this.instalacions.update(i=>i.filter(s=>s.id_instalacion!==t)),r.default.fire("Eliminado!","A instalaci\xF3n foi eliminada","success")}catch(i){let s=i.error?.message||"Non se puido eliminar a instalaci\xF3n";r.default.fire("Erro",s,"error")}finally{this.loading.set(!1)}}})}crearInstalacion(t){return n(this,null,function*(){this.loading.set(!0);try{return yield e(this.http.post(`${this.apiUrl}/admin/instalacions`,t)),r.default.fire({icon:"success",title:"Creada!",text:"A instalaci\xF3n creouse correctamente",confirmButtonColor:"#E2EFDA",confirmButtonText:'<span style="color:#333">Aceptar</span>'}),yield this.cargarDatos(),!0}catch(a){let i=a.error?.message||"Erro ao crear a instalaci\xF3n";return r.default.fire("Erro",i,"error"),!1}finally{this.loading.set(!1)}})}crearTipoInstalacion(t){return n(this,null,function*(){this.loading.set(!0);try{yield e(this.http.post(`${this.apiUrl}/tipos-instalacion`,{nome_tipo:t}));let a=yield e(this.http.get(`${this.apiUrl}/tipos-instalacion`));return this.tipos.set(a||[]),r.default.fire({icon:"success",title:"Tipo creado",text:`O tipo "${t}" foi creado correctamente`,timer:2e3,showConfirmButton:!1}),!0}catch{return r.default.fire("Erro","Non se puido crear o tipo. Pode que xa exista","error"),!1}finally{this.loading.set(!1)}})}getInstalacion(t){return n(this,null,function*(){return e(this.http.get(`${this.apiUrl}/admin/instalacions/${t}`))})}editarInstalacion(t,a){return n(this,null,function*(){this.loading.set(!0);try{return yield e(this.http.put(`${this.apiUrl}/admin/instalacions/${t}`,a)),r.default.fire({icon:"success",title:"Actualizada!",text:"A instalaci\xF3n actualizouse correctamente",confirmButtonColor:"#E2EFDA",confirmButtonText:'<span style="color:#333">Aceptar</span>'}),!0}catch(i){let s=i.error?.message||"Erro ao actualizar a instalaci\xF3n";return r.default.fire("Erro",s,"error"),!1}finally{this.loading.set(!1)}})}cargarReservas(){return n(this,null,function*(){this.loading.set(!0);try{let t=yield e(this.http.get(`${this.apiUrl}/admin/reservas`));this.reservas.set(t||[])}catch{r.default.fire("Erro","Non se puideron cargar as reservas","error")}finally{this.loading.set(!1)}})}cambiarEstadoReserva(t,a){return n(this,null,function*(){this.loading.set(!0);try{return yield e(this.http.put(`${this.apiUrl}/admin/reservas/${t}/estado`,{estado:a})),this.reservas.update(i=>i.map(s=>s.id_reserva===t?p(l({},s),{estado:a}):s)),r.default.fire("Actualizado!",`O estado cambiouse a "${a}"`,"success"),!0}catch{return r.default.fire("Erro","Non se puido cambiar o estado","error"),!1}finally{this.loading.set(!1)}})}cargarEstatisticas(){return n(this,null,function*(){this.loading.set(!0);try{let t=yield e(this.http.get(`${this.apiUrl}/admin/estatisticas`));this.estatisticas.set(t)}catch{r.default.fire("Erro","Non se puideron cargar as estat\xEDsticas","error")}finally{this.loading.set(!1)}})}exportarInforme(){return n(this,null,function*(){this.loading.set(!0);try{let t=yield e(this.http.get(`${this.apiUrl}/admin/estatisticas/exportar`,{responseType:"blob",observe:"response"})),a=new Blob([t.body],{type:"text/csv"}),i=window.URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download="informe_reservas.csv",s.click(),window.URL.revokeObjectURL(i),r.default.fire("\xC9xito","Informe descargado correctamente","success")}catch{r.default.fire("Erro","Non se puido descargar o informe","error")}finally{this.loading.set(!1)}})}static \u0275fac=function(a){return new(a||c)};static \u0275prov=d({token:c,factory:c.\u0275fac,providedIn:"root"})};export{f as a};
