<div class="container-mis-reservas">
    <header>
        <h1>As miñas Reservas</h1>
        <!-- Botón para volver ao catálogo de reservas -->
        <button routerLink="/reservas" class="btn-primary">← Volver ao Catálogo</button>
    </header>

    <!-- Indicador de carga -->
    <div *ngIf="loading()" class="loading-indicator">Cargando historial...</div>
    
    <!-- Mensaxe se non hay reservas -->
    <div *ngIf="!loading() && misReservas().length === 0" class="no-reservas">
        Aínda non tes ningunha reserva.
    </div>

    <!-- Táboa de Reservas -->
    <table *ngIf="misReservas().length > 0 && !loading()">
        <thead>
            <tr>
                <th>Data</th>
                <th>Instalación</th>
                <th>Horario</th>
                <th>Estado</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let reserva of misReservas()">
                <td>{{ reserva.data_reserva | date }}</td>
                <!-- Usamos o operador seguro '?' por se a relación non se cargou -->
                <td>{{ reserva.instalacion?.nome }}</td>
                
                <!-- Usamos a relación 'horario' para obter a hora -->
                <!-- Esto é máis robusto que usar os campos da reserva directamente. -->
                <td>{{ reserva.horario?.hora_inicio | slice:0:5 }} - {{ reserva.horario?.hora_fin | slice:0:5 }}</td>
                
                <td>
                    <span [ngClass]="{'estado-confirmada': reserva.estado === 'Confirmada', 'estado-cancelada': reserva.estado === 'Cancelada'}">
                        {{ reserva.estado }}
                    </span>
                </td>
                
                <td>
                    <!-- Botón de cancelación visible só se o estado é 'Confirmada' -->
                    <button 
                        *ngIf="reserva.estado === 'Confirmada'" 
                        (click)="onCancelar(reserva.id_reserva)"
                        class="btn-cancelar"
                    >
                        Cancelar
                    </button>
                    <span *ngIf="reserva.estado === 'Cancelada'" class="text-gray-500">
                        N/A
                    </span>
                </td>
            </tr>
        </tbody>
    </table>
</div>